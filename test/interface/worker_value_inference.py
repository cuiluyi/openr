import requests

controller_addr = "http://0.0.0.0:28777"
model_name = "Qwen2.5-Math-PRM-7B"


def replace_step_tag(answer: str, lm_step_tag: str, rm_step_tag: str):
    splits = answer.split(lm_step_tag)
    splits = [s.strip() for s in splits]
    # add a whitespace to avoid tokenization issue
    response = f" {rm_step_tag}".join([s for s in splits if s != ""])
    response += f" {rm_step_tag}"
    return response


prm_format_str = "{question}<this is qwen2.5-math-prm seperation &&&&& >{answer}"

question = "Find the greatest integer less than $(\\sqrt{7} + \\sqrt{5})^6.$  (Do not use a calculator!)"

# answer = "To find the greatest integer less than \\((\\sqrt{7} + \\sqrt{5})^6\\), we will use the binomial theorem and some algebraic manipulation. Let's denote \\(a = \\sqrt{7} + \\sqrt{5}\\) and \\(b = \\sqrt{7} - \\sqrt{5}\\). Notice that \\(a\\) and \\(b\\) are conjugates, and their product is:\n\n\\[\nab = (\\sqrt{7} + \\sqrt{5})(\\sqrt{7} - \\sqrt{5}) = 7 - 5 = 2.\n\\]\n\nWe are interested in \\(a^6\\). To find a useful expression, we consider the sum \\(a^6 + b^6\\). First, we calculate \\(a^2\\) and \\(b^2\\):\n\n\\[\na^2 = (\\sqrt{7} + \\sqrt{5})^2 = 7 + 2\\sqrt{35} + 5 = 12 + 2\\sqrt{35},\n\\]\n\\[\nb^2 = (\\sqrt{7} - \\sqrt{5})^2 = 7 - 2\\sqrt{35} + 5 = 12 - 2\\sqrt{35}.\n\\]\n\nNext, we calculate \\(a^4 + b^4\\):\n\n\\[\na^4 = (a^2)^2 = (12 + 2\\sqrt{35})^2 = 144 + 48\\sqrt{35} + 4 \\cdot 35 = 144 + 48\\sqrt{35} + 140 = 284 + 48\\sqrt{35},\n\\]\n\\[\nb^4 = (b^2)^2 = (12 - 2\\sqrt{35})^2 = 144 - 48\\sqrt{35} + 4 \\cdot 35 = 144 - 48\\sqrt{35} + 140 = 284 - 48\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^4 + b^4 = (284 + 48\\sqrt{35}) + (284 - 48\\sqrt{35}) = 568.\n\\]\n\nNow, we calculate \\(a^6 + b^6\\):\n\n\\[\na^6 + b^6 = (a^2)^3 + (b^2)^3 = (12 + 2\\sqrt{35})^3 + (12 - 2\\sqrt{35})^3.\n\\]\n\nUsing the binomial theorem, we expand each term:\n\n\\[\n(12 + 2\\sqrt{35})^3 = 12^3 + 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 + (2\\sqrt{35})^3 = 1728 + 864\\sqrt{35} + 1680 + 16\\sqrt{35} = 3408 + 880\\sqrt{35},\n\\]\n\\[\n(12 - 2\\sqrt{35})^3 = 12^3 - 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 - (2\\sqrt{35})^3 = 1728 - 864\\sqrt{35} + 1680 - 16\\sqrt{35} = 3408 - 880\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^6 + b^6 = (3408 + 880\\sqrt{35}) + (3408 - 880\\sqrt{35}) = 6816.\n\\]\n\nSince \\(b = \\sqrt{7} - \\sqrt{5}\\) is a small positive number (approximately 0.404), \\(b^6\\) is a very small positive number. Therefore, \\(a^6\\) is slightly less than 6816. The greatest integer less than \\(a^6\\) is:\n\n\\[\n\\boxed{6815}.\n\\]"
answer = [
    "To find the greatest integer less than \\((\\sqrt{7} + \\sqrt{5})^6\\), we will use the binomial theorem and some algebraic manipulation. Let's denote \\(a = \\sqrt{7} + \\sqrt{5}\\) and \\(b = \\sqrt{7} - \\sqrt{5}\\). Notice that \\(a\\) and \\(b\\) are conjugates, and their product is:\n\n\\[\nab = (\\sqrt{7} + \\sqrt{5})(\\sqrt{7} - \\sqrt{5}) = 7 - 5 = 2.\n\\]\n\nWe are interested in \\(a^6\\). To find a useful expression, we consider the sum \\(a^6 + b^6\\). First, we calculate \\(a^2\\) and \\(b^2\\):\n\n\\[\na^2 = (\\sqrt{7} + \\sqrt{5})^2 = 7 + 2\\sqrt{35} + 5 = 12 + 2\\sqrt{35},\n\\]\n\\[\nb^2 = (\\sqrt{7} - \\sqrt{5})^2 = 7 - 2\\sqrt{35} + 5 = 12 - 2\\sqrt{35}.\n\\]\n\nNext, we calculate \\(a^4 + b^4\\):\n\n\\[\na^4 = (a^2)^2 = (12 + 2\\sqrt{35})^2 = 144 + 48\\sqrt{35} + 4 \\cdot 35 = 144 + 48\\sqrt{35} + 140 = 284 + 48\\sqrt{35},\n\\]\n\\[\nb^4 = (b^2)^2 = (12 - 2\\sqrt{35})^2 = 144 - 48\\sqrt{35} + 4 \\cdot 35 = 144 - 48\\sqrt{35} + 140 = 284 - 48\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^4 + b^4 = (284 + 48\\sqrt{35}) + (284 - 48\\sqrt{35}) = 568.\n\\]\n\nNow, we calculate \\(a^6 + b^6\\):\n\n\\[\na^6 + b^6 = (a^2)^3 + (b^2)^3 = (12 + 2\\sqrt{35})^3 + (12 - 2\\sqrt{35})^3.\n\\]\n\nUsing the binomial theorem, we expand each term:\n\n\\[\n(12 + 2\\sqrt{35})^3 = 12^3 + 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 + (2\\sqrt{35})^3 = 1728 + 864\\sqrt{35} + 1680 + 16\\sqrt{35} = 3408 + 880\\sqrt{35},\n\\]\n\\[\n(12 - 2\\sqrt{35})^3 = 12^3 - 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 - (2\\sqrt{35})^3 = 1728 - 864\\sqrt{35} + 1680 - 16\\sqrt{35} = 3408 - 880\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^6 + b^6 = (3408 + 880\\sqrt{35}) + (3408 - 880\\sqrt{35}) = 6816.\n\\]\n\nSince \\(b = \\sqrt{7} - \\sqrt{5}\\) is a small positive number (approximately 0.404), \\(b^6\\) is a very small positive number. Therefore, \\(a^6\\) is slightly less than 6816. The greatest integer less than \\(a^6\\) is:\n\n\\[\n\\boxed{6815}.\n\\]",
    "To find the greatest integer less than \\((\\sqrt{7} + \\sqrt{5})^6\\), we will use the binomial theorem and some algebraic manipulation. Let's denote \\(a = \\sqrt{7} + \\sqrt{5}\\) and \\(b = \\sqrt{7} - \\sqrt{5}\\). Notice that \\(a\\) and \\(b\\) are conjugates, and their product is:\n\n\\[\nab = (\\sqrt{7} + \\sqrt{5})(\\sqrt{7} - \\sqrt{5}) = 7 - 5 = 2.\n\\]\n\nWe are interested in \\(a^6\\). To find a useful expression, we consider the sum \\(a^6 + b^6\\). First, we calculate \\(a^2\\) and \\(b^2\\):\n\n\\[\na^2 = (\\sqrt{7} + \\sqrt{5})^2 = 7 + 2\\sqrt{35} + 5 = 12 + 2\\sqrt{35},\n\\]\n\\[\nb^2 = (\\sqrt{7} - \\sqrt{5})^2 = 7 - 2\\sqrt{35} + 5 = 12 - 2\\sqrt{35}.\n\\]\n\nNext, we calculate \\(a^4 + b^4\\):\n\n\\[\na^4 = (a^2)^2 = (12 + 2\\sqrt{35})^2 = 144 + 48\\sqrt{35} + 4 \\cdot 35 = 144 + 48\\sqrt{35} + 140 = 284 + 48\\sqrt{35},\n\\]\n\\[\nb^4 = (b^2)^2 = (12 - 2\\sqrt{35})^2 = 144 - 48\\sqrt{35} + 4 \\cdot 35 = 144 - 48\\sqrt{35} + 140 = 284 - 48\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^4 + b^4 = (284 + 48\\sqrt{35}) + (284 - 48\\sqrt{35}) = 568.\n\\]\n\nNow, we calculate \\(a^6 + b^6\\):\n\n\\[\na^6 + b^6 = (a^2)^3 + (b^2)^3 = (12 + 2\\sqrt{35})^3 + (12 - 2\\sqrt{35})^3.\n\\]\n\nUsing the binomial theorem, we expand each term:\n\n\\[\n(12 + 2\\sqrt{35})^3 = 12^3 + 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 + (2\\sqrt{35})^3 = 1728 + 864\\sqrt{35} + 1680 + 16\\sqrt{35} = 3408 + 880\\sqrt{35},\n\\]\n\\[\n(12 - 2\\sqrt{35})^3 = 12^3 - 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 - (2\\sqrt{35})^3 = 1728 - 864\\sqrt{35} + 1680 - 16\\sqrt{35} = 3408 - 880\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^6 + b^6 = (3408 + 880\\sqrt{35}) + (3408 - 880\\sqrt{35}) = 6816.\n\\]\n\nSince \\(b = \\sqrt{7} - \\sqrt{5}\\) is a small positive number (approximately 0.404), \\(b^6\\) is a very small positive number. Therefore, \\(a^6\\) is slightly less than 6816. The greatest integer less than \\(a^6\\) is:\n\n\\[\n\\boxed{6815}.\n\\]",
    "To find the greatest integer less than \\((\\sqrt{7} + \\sqrt{5})^6\\), we will use the binomial theorem and some algebraic manipulation. Let's denote \\(a = \\sqrt{7} + \\sqrt{5}\\) and \\(b = \\sqrt{7} - \\sqrt{5}\\). Notice that \\(a\\) and \\(b\\) are conjugates, and their product is:\n\n\\[\nab = (\\sqrt{7} + \\sqrt{5})(\\sqrt{7} - \\sqrt{5}) = 7 - 5 = 2.\n\\]\n\nWe are interested in \\(a^6\\). To find a useful expression, we consider the sum \\(a^6 + b^6\\). First, we calculate \\(a^2\\) and \\(b^2\\):\n\n\\[\na^2 = (\\sqrt{7} + \\sqrt{5})^2 = 7 + 2\\sqrt{35} + 5 = 12 + 2\\sqrt{35},\n\\]\n\\[\nb^2 = (\\sqrt{7} - \\sqrt{5})^2 = 7 - 2\\sqrt{35} + 5 = 12 - 2\\sqrt{35}.\n\\]\n\nNext, we calculate \\(a^4 + b^4\\):\n\n\\[\na^4 = (a^2)^2 = (12 + 2\\sqrt{35})^2 = 144 + 48\\sqrt{35} + 4 \\cdot 35 = 144 + 48\\sqrt{35} + 140 = 284 + 48\\sqrt{35},\n\\]\n\\[\nb^4 = (b^2)^2 = (12 - 2\\sqrt{35})^2 = 144 - 48\\sqrt{35} + 4 \\cdot 35 = 144 - 48\\sqrt{35} + 140 = 284 - 48\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^4 + b^4 = (284 + 48\\sqrt{35}) + (284 - 48\\sqrt{35}) = 568.\n\\]\n\nNow, we calculate \\(a^6 + b^6\\):\n\n\\[\na^6 + b^6 = (a^2)^3 + (b^2)^3 = (12 + 2\\sqrt{35})^3 + (12 - 2\\sqrt{35})^3.\n\\]\n\nUsing the binomial theorem, we expand each term:\n\n\\[\n(12 + 2\\sqrt{35})^3 = 12^3 + 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 + (2\\sqrt{35})^3 = 1728 + 864\\sqrt{35} + 1680 + 16\\sqrt{35} = 3408 + 880\\sqrt{35},\n\\]\n\\[\n(12 - 2\\sqrt{35})^3 = 12^3 - 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 - (2\\sqrt{35})^3 = 1728 - 864\\sqrt{35} + 1680 - 16\\sqrt{35} = 3408 - 880\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^6 + b^6 = (3408 + 880\\sqrt{35}) + (3408 - 880\\sqrt{35}) = 6816.\n\\]\n\nSince \\(b = \\sqrt{7} - \\sqrt{5}\\) is a small positive number (approximately 0.404), \\(b^6\\) is a very small positive number. Therefore, \\(a^6\\) is slightly less than 6816. The greatest integer less than \\(a^6\\) is:\n\n\\[\n\\boxed{6815}.\n\\]",
    "To find the greatest integer less than \\((\\sqrt{7} + \\sqrt{5})^6\\), we will use the binomial theorem and some algebraic manipulation. Let's denote \\(a = \\sqrt{7} + \\sqrt{5}\\) and \\(b = \\sqrt{7} - \\sqrt{5}\\). Notice that \\(a\\) and \\(b\\) are conjugates, and their product is:\n\n\\[\nab = (\\sqrt{7} + \\sqrt{5})(\\sqrt{7} - \\sqrt{5}) = 7 - 5 = 2.\n\\]\n\nWe are interested in \\(a^6\\). To find a useful expression, we consider the sum \\(a^6 + b^6\\). First, we calculate \\(a^2\\) and \\(b^2\\):\n\n\\[\na^2 = (\\sqrt{7} + \\sqrt{5})^2 = 7 + 2\\sqrt{35} + 5 = 12 + 2\\sqrt{35},\n\\]\n\\[\nb^2 = (\\sqrt{7} - \\sqrt{5})^2 = 7 - 2\\sqrt{35} + 5 = 12 - 2\\sqrt{35}.\n\\]\n\nNext, we calculate \\(a^4 + b^4\\):\n\n\\[\na^4 = (a^2)^2 = (12 + 2\\sqrt{35})^2 = 144 + 48\\sqrt{35} + 4 \\cdot 35 = 144 + 48\\sqrt{35} + 140 = 284 + 48\\sqrt{35},\n\\]\n\\[\nb^4 = (b^2)^2 = (12 - 2\\sqrt{35})^2 = 144 - 48\\sqrt{35} + 4 \\cdot 35 = 144 - 48\\sqrt{35} + 140 = 284 - 48\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^4 + b^4 = (284 + 48\\sqrt{35}) + (284 - 48\\sqrt{35}) = 568.\n\\]\n\nNow, we calculate \\(a^6 + b^6\\):\n\n\\[\na^6 + b^6 = (a^2)^3 + (b^2)^3 = (12 + 2\\sqrt{35})^3 + (12 - 2\\sqrt{35})^3.\n\\]\n\nUsing the binomial theorem, we expand each term:\n\n\\[\n(12 + 2\\sqrt{35})^3 = 12^3 + 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 + (2\\sqrt{35})^3 = 1728 + 864\\sqrt{35} + 1680 + 16\\sqrt{35} = 3408 + 880\\sqrt{35},\n\\]\n\\[\n(12 - 2\\sqrt{35})^3 = 12^3 - 3 \\cdot 12^2 \\cdot 2\\sqrt{35} + 3 \\cdot 12 \\cdot (2\\sqrt{35})^2 - (2\\sqrt{35})^3 = 1728 - 864\\sqrt{35} + 1680 - 16\\sqrt{35} = 3408 - 880\\sqrt{35}.\n\\]\n\nAdding these, we get:\n\n\\[\na^6 + b^6 = (3408 + 880\\sqrt{35}) + (3408 - 880\\sqrt{35}) = 6816.\n\\]\n\nSince \\(b = \\sqrt{7} - \\sqrt{5}\\) is a small positive number (approximately 0.404), \\(b^6\\) is a very small positive number. Therefore, \\(a^6\\) is slightly less than 6816. The greatest integer less than \\(a^6\\) is:\n\n\\[\n\\boxed{6815}.\n\\]",
]

if isinstance(answer, str):
    input_str = prm_format_str.format(
        question=question,
        answer=replace_step_tag(answer, "\n\n", "<extra_0>"),
    )
else:
    input_str = [
        prm_format_str.format(
            question=s,
            answer=replace_step_tag(s, "\n\n", "<extra_0>"),
        )
        for s in answer
    ]


ret = requests.post(controller_addr + "/get_worker_address", json={"model": model_name})
worker_addr = ret.json()["address"]
if not worker_addr:
    raise ValueError("Value Model name {} does not exist.".format(model_name))

headers = {"User-Agent": "FastChat Client"}
gen_params = {"input_str": input_str}
response = requests.post(
    worker_addr + "/worker_value_inference",
    headers=headers,
    json=gen_params,
    stream=True,
)
print(response)
print(response.json())
